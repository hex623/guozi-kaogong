<!-- pages/question-detail/question-detail.wxml -->
<view class="container">
  <view wx:if="{{question}}" class="detail-card">
    <!-- å¤´éƒ¨ä¿¡æ¯ -->
    <view class="detail-header">
      <view class="detail-tags">
        <text wx:for="{{question.tags}}" wx:key="*this" class="tag">{{item}}</text>
        <text wx:if="{{question.tags.length === 0}}" class="tag empty">æœªåˆ†ç±»</text>
      </view>
      
      <view class="detail-actions">
        <text wx:if="{{!isEditing}}" bindtap="startEdit">âœï¸</text>
        <text bindtap="deleteQuestion">ğŸ—‘ï¸</text>
      </view>
    </view>

    <!-- é¢˜ç›®ç…§ç‰‡ -->
    <view class="question-images">
      <image wx:for="{{question.photos}}" wx:key="*this"
             src="{{item}}" mode="widthFix"
             bindtap="previewImage"
             data-url="{{item}}"/>
    </view>

    <!-- æŸ¥çœ‹æ¨¡å¼ -->
    <view wx:if="{{!isEditing}}">
      <!-- é”™è¯¯ç­”æ¡ˆ -->
      <view wx:if="{{question.wrongAnswer}}" class="wrong-answer-section">
        <view class="section-label wrong">âŒ é”™è¯¯ç­”æ¡ˆ</view>
        <text class="answer-content">{{question.wrongAnswer}}</text>
      </view>

      <!-- æ­£ç¡®ç­”æ¡ˆ -->
      <view class="correct-answer-section">
        <view class="section-label correct">âœ… æ­£ç¡®ç­”æ¡ˆ</view>
        
        <text wx:if="{{question.answerType === 'text'}}" class="answer-content">{{question.correctAnswer}}</text>
        
        <image wx:if="{{question.answerType === 'image' && question.correctAnswerImage}}"
               src="{{question.correctAnswerImage}}"
               mode="widthFix"
               bindtap="previewAnswerImage"/>
      </view>
    </view>

    <!-- ç¼–è¾‘æ¨¡å¼ -->
    <view wx:if="{{isEditing}}" class="edit-section">
      <view class="edit-title">âœï¸ ç¼–è¾‘é”™é¢˜</view>
      
      <!-- ç¼–è¾‘æ­£ç¡®ç­”æ¡ˆ -->
      <view class="edit-item">
        <text class="edit-label">âœ… æ­£ç¡®ç­”æ¡ˆ</text>
        <textarea wx:if="{{question.answerType === 'text'}}"
                  class="edit-textarea"
                  value="{{editData.correctAnswer}}"
                  bindinput="onCorrectAnswerInput"
                  placeholder="è¾“å…¥æ­£ç¡®ç­”æ¡ˆ..."/>
        
        <view wx:if="{{question.answerType === 'image'}}" class="edit-hint">
          å›¾ç‰‡ç­”æ¡ˆä¸æ”¯æŒä¿®æ”¹
        </view>
      </view>

      <!-- ç¼–è¾‘é”™è¯¯ç­”æ¡ˆ -->
      <view class="edit-item">
        <text class="edit-label">âŒ é”™è¯¯ç­”æ¡ˆ</text>
        <textarea class="edit-textarea"
                  value="{{editData.wrongAnswer}}"
                  bindinput="onWrongAnswerInput"
                  placeholder="è®°å½•ä½ å½“æ—¶é€‰é”™çš„ç­”æ¡ˆ..."/>
      </view>

      <!-- ç¼–è¾‘æ ‡ç­¾ -->
      <view class="edit-item">
        <text class="edit-label">ğŸ·ï¸ æ ‡ç­¾</text>
        
        <view class="edit-tags">
          <view wx:for="{{editData.tags}}" wx:key="*this" class="edit-tag">
            <text>{{item}}</text>
            <text class="edit-tag-delete" bindtap="removeTag" data-tag="{{item}}">Ã—</text>
          </view>
        </view>
        
        <input class="edit-tag-input"
               placeholder="æ·»åŠ æ ‡ç­¾"
               bindconfirm="addTag"/>
      </view>

      <!-- ç¼–è¾‘æŒ‰é’® -->
      <view class="edit-actions">
        <button class="btn-secondary" bindtap="cancelEdit">å–æ¶ˆ</button>
        <button class="btn-primary" bindtap="saveEdit">ä¿å­˜</button>
      </view>
    </view>

    <!-- æ·»åŠ æ—¥æœŸ -->
    <view class="meta-section">
      <view class="meta-item">
        <text class="meta-label">ğŸ“… æ·»åŠ æ—¥æœŸ</text>
        <text class="meta-value">{{question.addDate}}</text>
      </view>
    </view>

    <!-- å¤ä¹ å†å² -->
    <view class="review-history-section">
      <view class="section-title">ğŸ“ˆ å¤ä¹ å†å²</view>
      
      <view class="review-timeline">
        <view wx:for="{{reviewHistory}}" wx:key="_id" class="timeline-item">
          <view class="timeline-dot {{item.isMastered ? 'mastered' : 'forgot'}}"></view>
          
          <view class="timeline-content">
            <text class="timeline-date">{{item.date}}</text>
            <text class="timeline-result {{item.isMastered ? 'mastered' : 'forgot'}}">
              {{item.isMastered ? 'å·²æŒæ¡' : 'è¿˜éœ€å¤ä¹ '}}
            </text>
          </view>
        </view>
        
        <view wx:if="{{reviewHistory.length === 0}}" class="empty-history">
          <text>æš‚æ— å¤ä¹ è®°å½•</text>
        </view>
      </view>
    </view>

    <!-- çŠ¶æ€ -->
    <view class="status-section">
      <view class="status-badge {{question.status}}">
        {{question.status === 'mastered' ? 'å·²æŒæ¡' : 'å­¦ä¹ ä¸­'}}
      </view>      
      <text wx:if="{{question.status === 'mastered'}}" class="status-text">
        âœ… å·²å®Œæˆå…¨éƒ¨5æ¬¡å¤ä¹ 
      </text>      
      <text wx:else class="status-text">
        ğŸ“š ç¬¬ {{question.reviewCount || 0}}/5 æ¬¡å¤ä¹ 
      </text>
    </view>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view wx:if="{{loading}}" class="loading-state">
    <text>åŠ è½½ä¸­...</text>
  </view>
</view>
