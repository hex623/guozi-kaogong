<!-- pages/review/review.wxml -->
<view class="container">
  <!-- ä»Šæ—¥å¾…å¤ä¹ ç»Ÿè®¡ -->
  <view class="header-card">
    <view class="header-content">
      <view class="review-count">
        <text class="count-number">{{todayList.length}}</text>
        <text class="count-label">ä»Šæ—¥å¾…å¤ä¹ </text>
      </view>
      
      <view class="review-progress" wx:if="{{todayList.length > 0}}">
        <text class="progress-text">å·²å®Œæˆ {{completedCount}}/{{todayList.length}}</text>
        <view class="progress-bar">
          <view class="progress-fill" style="width: {{(completedCount/todayList.length)*100}}%"></view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:if="{{todayList.length === 0 && !loading}}" class="empty-state">
    <view class="empty-icon">ğŸ‰</view>
    <text class="empty-title">ä»Šæ—¥å¤ä¹ å·²å®Œæˆ</text>
    <text class="empty-desc">åŸºäºè‰¾å®¾æµ©æ–¯é—å¿˜æ›²çº¿ï¼Œæ–°é”™é¢˜å°†åœ¨ç¬¬1/2/4/7/15å¤©è‡ªåŠ¨æ¨é€</text>
    
    <button class="btn-secondary" bindtap="goToAdd">å»å½•å…¥æ–°é”™é¢˜</button>
  </view>

  <!-- å½“å‰å¤ä¹ é¢˜ç›® -->
  <view wx:if="{{currentQuestion && !showResult}}" class="review-card">
    <!-- é¢˜ç›®ä¿¡æ¯ -->
    <view class="question-header">
      <view class="question-meta">
        <text class="review-stage">ç¬¬{{currentQuestion.reviewCount + 1}}æ¬¡å¤ä¹ </text>
        <text class="question-source" wx:if="{{currentQuestion.source}}">{{currentQuestion.source}}</text>
      </view>
      
      <view class="question-tags" wx:if="{{currentQuestion.tags.length > 0}}">
        <text wx:for="{{currentQuestion.tags}}" wx:key="*this" class="tag">{{item}}</text>
      </view>
    </view>

    <!-- é¢˜ç›®ç…§ç‰‡ -->
    <view class="question-images">
      <image wx:for="{{currentQuestion.photos}}" wx:key="*this"
             src="{{item}}" mode="widthFix" 
             bindtap="previewQuestionImage"
             data-url="{{item}}"/>
    </view>

    <!-- é”™è¯¯ç­”æ¡ˆæç¤º -->
    <view wx:if="{{currentQuestion.wrongAnswer}}" class="wrong-answer-hint">
      <text class="hint-label">âŒ ä¸Šæ¬¡é”™é€‰</text>
      <text class="hint-content">{{currentQuestion.wrongAnswer}}</text>
    </view>

    <!-- æŸ¥çœ‹ç­”æ¡ˆæŒ‰é’® -->
    <view class="action-area" wx:if="{{!showAnswer}}">
      <button class="btn-primary btn-large" bindtap="showAnswer">
        æŸ¥çœ‹ç­”æ¡ˆ
      </button>
    </view>

    <!-- ç­”æ¡ˆåŒºåŸŸ -->
    <view wx:if="{{showAnswer}}" class="answer-section">
      <view class="answer-label">âœ… æ­£ç¡®ç­”æ¡ˆ</view>
      
      <view wx:if="{{currentQuestion.answerType === 'text'}}" class="answer-text">
        {{currentQuestion.correctAnswer}}
      </view>
      
      <image wx:if="{{currentQuestion.answerType === 'image' && currentQuestion.correctAnswerImage}}"
             src="{{currentQuestion.correctAnswerImage}}" 
             mode="widthFix"
             class="answer-image"
             bindtap="previewAnswerImage"/>

      <!-- æŒæ¡ç¨‹åº¦é€‰æ‹© -->
      <view class="mastery-section">
        <text class="mastery-title">æŒæ¡ç¨‹åº¦å¦‚ä½•ï¼Ÿ</text>
        
        <view class="mastery-buttons">
          <button class="btn-mastery btn-forgot" bindtap="markForgot">
            <text class="btn-icon">ğŸ˜µ</text>
            <text>è¿˜éœ€å¤ä¹ </text>
            <text class="btn-desc">å¢åŠ å¤ä¹ é¢‘ç‡</text>
          </button>
          
          <button class="btn-mastery btn-mastered" bindtap="markMastered"
                  disabled="{{isSubmitting}}">
            <text class="btn-icon">âœ…</text>
            <text>å·²æŒæ¡</text>
            <text class="btn-desc">å‡å°‘æ¨é€é¢‘ç‡</text>
          </button>
        </view>
      </view>
    </view>
  </view>

  <!-- å®ŒæˆçŠ¶æ€ -->
  <view wx:if="{{showResult}}" class="result-card">
    <view class="result-icon">{{resultIcon}}</view>
    <text class="result-title">{{resultTitle}}</text>
    <text class="result-desc">{{resultDesc}}</text>
    
    <view class="next-review-info" wx:if="{{nextReviewDate}}">
      <text>ä¸‹æ¬¡å¤ä¹ ï¼š{{nextReviewDate}}</text>
    </view>
    
    <button class="btn-primary" bindtap="nextQuestion">
      {{currentIndex < todayList.length - 1 ? 'ä¸‹ä¸€é¢˜' : 'å®Œæˆå¤ä¹ '}}
    </button>
  </view>
</view>
