<!-- pages/library/library.wxml -->
<view class="container">
  <!-- æœç´¢å’Œç­›é€‰ -->
  <view class="filter-bar">
    <view class="search-box">
      <input placeholder="æœç´¢é¢˜ç›®ã€å‡ºå¤„..." 
             value="{{searchKey}}"
             bindinput="onSearchInput"
             confirm-type="search"
             bindconfirm="doSearch"/>
      <text class="search-icon">ğŸ”</text>
    </view>
  </view>

  <!-- æ ‡ç­¾ç­›é€‰ -->
  <view class="tags-filter" wx:if="{{allTags.length > 0}}">
    <scroll-view scroll-x class="tags-scroll">
      <view class="tag {{selectedTag === '' ? 'active' : ''}}" bindtap="filterByTag" data-tag="">
        å…¨éƒ¨
      </view>
      
      <view wx:for="{{allTags}}" wx:key="*this"
            class="tag {{selectedTag === item ? 'active' : ''}}"
            bindtap="filterByTag"
            data-tag="{{item}}">
        {{item}}
      </view>
    </scroll-view>
  </view>

  <!-- çŠ¶æ€ç­›é€‰ -->
  <view class="status-filter">
    <view class="status-tab {{statusFilter === 'all' ? 'active' : ''}}" bindtap="filterByStatus" data-status="all">
      å…¨éƒ¨({{statusCounts.all}})
    </view>
    <view class="status-tab {{statusFilter === 'learning' ? 'active' : ''}}" bindtap="filterByStatus" data-status="learning">
      å­¦ä¹ ä¸­({{statusCounts.learning}})
    </view>
    <view class="status-tab {{statusFilter === 'mastered' ? 'active' : ''}}" bindtap="filterByStatus" data-status="mastered">
      å·²æŒæ¡({{statusCounts.mastered}})
    </view>
  </view>

  <!-- é”™é¢˜åˆ—è¡¨ -->
  <view class="question-list">
    <view wx:for="{{filteredQuestions}}" wx:key="_id" 
          class="question-item"
          bindtap="goToDetail"
          data-id="{{item._id}}">
      
      <view class="question-thumb">
        <image src="{{item.photos[0]}}" mode="aspectFill"/>
      </view>
      
      <view class="question-info">
        <view class="question-tags-row">
          <text wx:for="{{item.tags}}" wx:key="*this" wx:for-item="tag" class="mini-tag">{{tag}}</text>
          <text wx:if="{{item.tags.length === 0}}" class="mini-tag empty">æœªåˆ†ç±»</text>
        </view>
        
        <text class="question-source" wx:if="{{item.source}}">{{item.source}}</text>
        <text class="question-date">{{item.addDate}}</text>
        
        <view class="question-meta">
          <view class="review-progress">
            <text class="progress-text">å¤ä¹  {{item.reviewCount || 0}}/5</text>
            <view class="progress-dots">
              <view wx:for="{{5}}" wx:key="*this" wx:for-index="idx"
                    class="dot {{idx < (item.reviewCount || 0) ? 'filled' : ''}}"></view>
            </view>
          </view>
          
          <view class="status-badge {{item.status}}">
            {{item.status === 'mastered' ? 'å·²æŒæ¡' : 'å­¦ä¹ ä¸­'}}
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view wx:if="{{filteredQuestions.length === 0 && !loading}}" class="empty-state">
    <view class="empty-icon">ğŸ“š</view>
    <text class="empty-text">{{emptyText}}</text>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view wx:if="{{hasMore}}" class="load-more">
    <text bindtap="loadMore">{{loadingMore ? 'åŠ è½½ä¸­...' : 'åŠ è½½æ›´å¤š'}}</text>
  </view>
</view>
